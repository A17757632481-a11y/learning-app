# 云端数据同步功能使用指南

## 功能概述

现在你的英语学习系统支持云端数据同步功能！主要特性：

✅ **用户注册/登录系统** - 每个用户独立的学习数据  
✅ **自动云端同步** - 每5分钟自动备份到服务器  
✅ **手动同步** - 随时手动触发数据同步  
✅ **多设备同步** - 在不同设备间同步学习进度  
✅ **数据安全** - 密码加密存储，JWT token认证  

## 快速开始

### 第一步：启动后端服务器

1. 打开终端，进入server目录：
```bash
cd server
```

2. 安装依赖（首次运行）：
```bash
npm install
```

3. 复制环境变量配置：
```bash
copy .env.example .env
```

4. 启动服务器：
```bash
npm start
```

服务器将在 `http://localhost:3001` 启动

### 第二步：配置前端环境变量

1. 在项目根目录，复制 `.env.example` 为 `.env`
2. 确保包含以下配置：
```
VITE_API_URL=http://localhost:3001/api
```

### 第三步：启动前端应用

```bash
npm run dev
```

## 使用流程

### 1. 注册账号

- 访问网站，点击右上角 **"🔐 登录/注册"**
- 切换到 **"注册"** 标签
- 填写用户名、邮箱、密码（至少6位）
- 点击注册
- 系统会自动上传你的本地学习数据到服务器

### 2. 登录账号

- 点击右上角 **"🔐 登录/注册"**
- 输入邮箱和密码
- 登录成功后会询问是否下载服务器数据：
  - **确定**：下载服务器数据并与本地合并
  - **取消**：保留本地数据并上传到服务器

### 3. 自动同步

登录后，系统会：
- ✅ 每5分钟自动同步数据到服务器
- ✅ 在后台静默运行，不影响使用
- ✅ 同步失败会在控制台显示错误

### 4. 手动同步

- 点击右上角用户名
- 选择 **"🔄 手动同步数据"**
- 立即上传当前所有数据到服务器

### 5. 退出登录

- 点击右上角用户名
- 选择 **"🚪 退出登录"**
- 本地数据会保留，下次登录可继续同步

## 多设备使用

### 场景1：在新设备上使用

1. 在新设备上打开网站
2. 登录你的账号
3. 选择"确定"下载服务器数据
4. 所有学习进度会自动恢复

### 场景2：在多个设备间切换

1. 在设备A上学习并自动同步
2. 切换到设备B，登录账号
3. 数据会自动合并（本地优先）
4. 继续学习，数据继续同步

## 数据安全

### 密码安全
- 密码使用bcrypt加密存储
- 服务器不保存明文密码
- 建议使用强密码（字母+数字+符号）

### Token认证
- 使用JWT token进行身份验证
- Token有效期30天
- 过期后需要重新登录

### 数据隔离
- 每个用户的数据完全隔离
- 其他用户无法访问你的学习数据

## 常见问题

### Q: 清除浏览器缓存会丢失数据吗？
A: 不会！只要你登录了账号，数据都在服务器上。清除缓存后重新登录即可恢复。

### Q: 可以在手机和电脑上同时使用吗？
A: 可以！登录同一账号，数据会自动同步。

### Q: 忘记密码怎么办？
A: 目前暂不支持密码找回，请妥善保管密码。后续版本会添加邮箱找回功能。

### Q: 服务器挂了数据会丢失吗？
A: 不会！本地数据始终保留。服务器恢复后重新登录即可同步。

### Q: 可以导出数据吗？
A: 可以！使用之前创建的 `dataManager.ts` 服务导出JSON文件。

### Q: 同步失败怎么办？
A: 检查：
1. 服务器是否正常运行（`http://localhost:3001/api/health`）
2. 网络连接是否正常
3. Token是否过期（重新登录）

## 技术细节

### 同步机制
- 使用localStorage作为本地存储
- 定时器每5分钟触发一次同步
- 合并策略：本地数据优先

### 数据格式
```json
{
  "vocab-words": [...],
  "review-words": [...],
  "checkin-records": [...],
  "wrong-questions": [...],
  ...
}
```

### API端点
- 注册：`POST /api/auth/register`
- 登录：`POST /api/auth/login`
- 上传：`POST /api/sync/upload`
- 下载：`GET /api/sync/download`

## 下一步计划

- [ ] 密码找回功能
- [ ] 数据版本控制
- [ ] 冲突解决策略
- [ ] 离线模式支持
- [ ] 数据统计分析
- [ ] 社交功能（好友、排行榜）

## 需要帮助？

如果遇到问题，请检查：
1. 服务器日志（终端输出）
2. 浏览器控制台（F12）
3. 网络请求（F12 -> Network）

---

**祝学习愉快！🎉**
